{"version":3,"sources":["idb-promised.js","idb.js"],"names":["createIndexedDB","window","idb","open","upgradeDb","oldVersion","objectStoreNames","contains","console","log","createObjectStore","keyPath","reviewsOS","autoIncrement","createIndex","unique","promisifyRequest","request","Promise","resolve","reject","onsuccess","result","onerror","error","promisifyRequestCall","obj","method","args","p","apply","then","proxyProperties","ProxyClass","targetProp","properties","forEach","prop","Object","defineProperty","prototype","get","this","proxyRequestMethods","Constructor","arguments","proxyMethods","proxyCursorRequestMethods","value","Cursor","Index","index","_index","cursor","_cursor","_request","ObjectStore","store","_store","Transaction","idbTransaction","_tx","complete","oncomplete","UpgradeDB","db","transaction","_db","DB","IDBIndex","IDBCursor","methodName","IDBObjectStore","objectStore","IDBTransaction","IDBDatabase","funcName","replace","arr","Array","slice","call","callback","length","getAll","query","count","instance","items","iterateCursor","push","undefined","continue","exp","name","version","upgradeCallback","indexedDB","onupgradeneeded","event","delete","module","exports","self","dbPromise","saveRestaurantsDataLocally","restaurants","tx","all","map","restaurant","put","catch","abort","Error","getLocalRestaurantsData","getLocalRestaurantByIdData","id","parseInt","saveReviewsDataLocally","reviews","review","getLocalReviewsByIdData"],"mappings":"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","file":"idb-bundle.min.js","sourcesContent":["/*\nCopyright 2018 Google Inc.\n\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n'use strict';\n\n(function() {\n  function toArray(arr) {\n    return Array.prototype.slice.call(arr);\n  }\n\n  function promisifyRequest(request) {\n    return new Promise(function(resolve, reject) {\n      request.onsuccess = function() {\n        resolve(request.result);\n      };\n\n      request.onerror = function() {\n        reject(request.error);\n      };\n    });\n  }\n\n  function promisifyRequestCall(obj, method, args) {\n    var request;\n    var p = new Promise(function(resolve, reject) {\n      request = obj[method].apply(obj, args);\n      promisifyRequest(request).then(resolve, reject);\n    });\n\n    p.request = request;\n    return p;\n  }\n\n  function promisifyCursorRequestCall(obj, method, args) {\n    var p = promisifyRequestCall(obj, method, args);\n    return p.then(function(value) {\n      if (!value) return;\n      return new Cursor(value, p.request);\n    });\n  }\n\n  function proxyProperties(ProxyClass, targetProp, properties) {\n    properties.forEach(function(prop) {\n      Object.defineProperty(ProxyClass.prototype, prop, {\n        get: function() {\n          return this[targetProp][prop];\n        }\n      });\n    });\n  }\n\n  function proxyRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function proxyMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return this[targetProp][prop].apply(this[targetProp], arguments);\n      };\n    });\n  }\n\n  function proxyCursorRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyCursorRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function Index(index) {\n    this._index = index;\n  }\n\n  proxyProperties(Index, '_index', [\n    'name',\n    'keyPath',\n    'multiEntry',\n    'unique'\n  ]);\n\n  proxyRequestMethods(Index, '_index', IDBIndex, [\n    'get',\n    'getKey',\n    'getAll',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(Index, '_index', IDBIndex, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  function Cursor(cursor, request) {\n    this._cursor = cursor;\n    this._request = request;\n  }\n\n  proxyProperties(Cursor, '_cursor', [\n    'direction',\n    'key',\n    'primaryKey',\n    'value'\n  ]);\n\n  proxyRequestMethods(Cursor, '_cursor', IDBCursor, [\n    'update',\n    'delete'\n  ]);\n\n  // proxy 'next' methods\n  ['advance', 'continue', 'continuePrimaryKey'].forEach(function(methodName) {\n    if (!(methodName in IDBCursor.prototype)) return;\n    Cursor.prototype[methodName] = function() {\n      var cursor = this;\n      var args = arguments;\n      return Promise.resolve().then(function() {\n        cursor._cursor[methodName].apply(cursor._cursor, args);\n        return promisifyRequest(cursor._request).then(function(value) {\n          if (!value) return;\n          return new Cursor(value, cursor._request);\n        });\n      });\n    };\n  });\n\n  function ObjectStore(store) {\n    this._store = store;\n  }\n\n  ObjectStore.prototype.createIndex = function() {\n    return new Index(this._store.createIndex.apply(this._store, arguments));\n  };\n\n  ObjectStore.prototype.index = function() {\n    return new Index(this._store.index.apply(this._store, arguments));\n  };\n\n  proxyProperties(ObjectStore, '_store', [\n    'name',\n    'keyPath',\n    'indexNames',\n    'autoIncrement'\n  ]);\n\n  proxyRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'put',\n    'add',\n    'delete',\n    'clear',\n    'get',\n    'getAll',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  proxyMethods(ObjectStore, '_store', IDBObjectStore, [\n    'deleteIndex'\n  ]);\n\n  function Transaction(idbTransaction) {\n    this._tx = idbTransaction;\n    this.complete = new Promise(function(resolve, reject) {\n      idbTransaction.oncomplete = function() {\n        resolve();\n      };\n      idbTransaction.onerror = function() {\n        reject(idbTransaction.error);\n      };\n    });\n  }\n\n  Transaction.prototype.objectStore = function() {\n    return new ObjectStore(this._tx.objectStore.apply(this._tx, arguments));\n  };\n\n  proxyProperties(Transaction, '_tx', [\n    'objectStoreNames',\n    'mode'\n  ]);\n\n  proxyMethods(Transaction, '_tx', IDBTransaction, [\n    'abort'\n  ]);\n\n  function UpgradeDB(db, oldVersion, transaction) {\n    this._db = db;\n    this.oldVersion = oldVersion;\n    this.transaction = new Transaction(transaction);\n  }\n\n  UpgradeDB.prototype.createObjectStore = function() {\n    return new ObjectStore(this._db.createObjectStore.apply(this._db, arguments));\n  };\n\n  proxyProperties(UpgradeDB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(UpgradeDB, '_db', IDBDatabase, [\n    'deleteObjectStore',\n    'close'\n  ]);\n\n  function DB(db) {\n    this._db = db;\n  }\n\n  DB.prototype.transaction = function() {\n    return new Transaction(this._db.transaction.apply(this._db, arguments));\n  };\n\n  proxyProperties(DB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(DB, '_db', IDBDatabase, [\n    'close'\n  ]);\n\n  // Add cursor iterators\n  // TODO: remove this once browsers do the right thing with promises\n  ['openCursor', 'openKeyCursor'].forEach(function(funcName) {\n    [ObjectStore, Index].forEach(function(Constructor) {\n      Constructor.prototype[funcName.replace('open', 'iterate')] = function() {\n        var args = toArray(arguments);\n        var callback = args[args.length - 1];\n        var request = (this._store || this._index)[funcName].apply(this._store, args.slice(0, -1));\n        request.onsuccess = function() {\n          callback(request.result);\n        };\n      };\n    });\n  });\n\n  // polyfill getAll\n  [Index, ObjectStore].forEach(function(Constructor) {\n    if (Constructor.prototype.getAll) return;\n    Constructor.prototype.getAll = function(query, count) {\n      var instance = this;\n      var items = [];\n\n      return new Promise(function(resolve) {\n        instance.iterateCursor(query, function(cursor) {\n          if (!cursor) {\n            resolve(items);\n            return;\n          }\n          items.push(cursor.value);\n\n          if (count !== undefined && items.length == count) {\n            resolve(items);\n            return;\n          }\n          cursor.continue();\n        });\n      });\n    };\n  });\n\n  var exp = {\n    open: function(name, version, upgradeCallback) {\n      var p = promisifyRequestCall(indexedDB, 'open', [name, version]);\n      var request = p.request;\n\n      request.onupgradeneeded = function(event) {\n        if (upgradeCallback) {\n          upgradeCallback(new UpgradeDB(request.result, event.oldVersion, request.transaction));\n        }\n      };\n\n      return p.then(function(db) {\n        return new DB(db);\n      });\n    },\n    delete: function(name) {\n      return promisifyRequestCall(indexedDB, 'deleteDatabase', [name]);\n    }\n  };\n\n  if (typeof module !== 'undefined') {\n    module.exports = exp;\n  }\n  else {\n    self.idb = exp;\n  }\n}());\n","/*\n * IndexedDB\n */\n\n// Create the IndexedDB database.\nfunction createIndexedDB() {\n  // Checking for IndexedDB support.\n  if (!('indexedDB' in window)) {\n    console.log('[INFO] This browser doesn\\'t support IndexedDB.');\n    return null;\n  }\n  // Opening a database.\n  return idb.open('pwa-resto-db1', 3, function(upgradeDb) {\n    switch (upgradeDb.oldVersion) {\n      case 0:\n        // A placeholder case so that the switch block will\n        // execute when the database is first created\n        // (oldVersion is 0)\n      case 1:\n        // Creating object store for restaurants.\n        // A key path is a property that always exists and contains a unique\n        // value. Objects added to this store must have an id property and\n        // the value must be unique.\n        if (!upgradeDb.objectStoreNames.contains('restaurants')) {\n          console.log('[DEBUG] Creating a new object store for restaurants.');\n          const restaurantsOS =\n            upgradeDb.createObjectStore('restaurants', {keyPath: 'id'});\n        }\n      case 2:\n        // Creating object store for reviews, index for restaurant_id.\n        if (!upgradeDb.objectStoreNames.contains('reviews')) {\n          // Using a key generator as users can post reviews.\n          console.log('[DEBUG] Creating a new object store for reviews.');\n          const reviewsOS =\n            upgradeDb.createObjectStore('reviews', {keyPath: 'id', autoIncrement: true});\n          console.log(\n            '[DEBUG] Creating a restaurant_id index on object store reviews');\n          reviewsOS.createIndex(\n            'restaurant_id', 'restaurant_id', {unique: false});\n        }\n    }\n  });\n}\n\n// Database object.\nconst dbPromise = createIndexedDB();\n\n/**\n * Write restaurants data to object store restaurants.\n * The saveRestaurantsDataLocally function takes an array of objects and adds\n * or updates each object to the IndexedDB database. The store.put operations\n * happen inside a Promise.all. This way if any of the put operations fail,\n * we can catch the error and abort the transaction. Aborting the transaction\n * rolls back all the changes that happened in the transaction so that if any\n * of the events fail to put, none of them will be added to the object store.\n */\nfunction saveRestaurantsDataLocally(restaurants) {\n  if (!('indexedDB' in window)) {return null;}\n  return dbPromise.then(db => {\n    const tx = db.transaction('restaurants', 'readwrite');\n    const store = tx.objectStore('restaurants');\n    // Don't use Promise.all when there's only one restaurant.\n    if (restaurants.length > 1) {\n      return Promise.all(restaurants.map(restaurant => store.put(restaurant)))\n        .catch(() => {\n          tx.abort();\n          throw Error('[ERROR] Restaurants were not added to the store.');\n        });\n    } else {\n      store.put(restaurants);\n    }\n  });\n}\n\n// Get restaurants data from object store restaurants.\nfunction getLocalRestaurantsData() {\n  if (!('indexedDB' in window)) {return null;}\n  return dbPromise.then(db => {\n    const tx = db.transaction('restaurants', 'readonly');\n    const store = tx.objectStore('restaurants');\n    return store.getAll();\n  });\n}\n\n// Get restaurant by id data from object store restaurants.\nfunction getLocalRestaurantByIdData(id) {\n  if (!('indexedDB' in window)) {return null;}\n  return dbPromise.then(db => {\n    const tx = db.transaction('restaurants', 'readonly');\n    const store = tx.objectStore('restaurants');\n    // Make sure you're using a number for id.\n    return store.get(parseInt(id));\n  });\n}\n\n/**\n * Write reviews data to object store reviews.\n * The saveReviewsDataLocally function takes an array of objects and adds\n * or updates each object to the IndexedDB database. The store.put operations\n * happen inside a Promise.all. This way if any of the put operations fail,\n * we can catch the error and abort the transaction. Aborting the transaction\n * rolls back all the changes that happened in the transaction so that if any\n * of the events fail to put, none of them will be added to the object store.\n *\n * TODO: this function doesn't seem to work when there's only one review...\n * Error: Uncaught (in promise) DOMException: Failed to execute 'put' on\n * 'IDBObjectStore': Evaluating the object store's key path did not yield\n * a value.\n */\nfunction saveReviewsDataLocally(reviews) {\n  if (!('indexedDB' in window)) {return null;}\n  return dbPromise.then(db => {\n    const tx = db.transaction('reviews', 'readwrite');\n    const store = tx.objectStore('reviews');\n    // Don't use Promise.all when there's only one review.\n    if (reviews.length > 1) {\n      return Promise.all(reviews.map(review => store.put(review)))\n        .catch(() => {\n          tx.abort();\n          throw Error('[ERROR] Reviews were not added to the store.');\n        });\n    } else {\n      store.put(reviews);\n    }\n  });\n}\n\n// Get reviews by id data from object store reviews, using the index on\n// restaurant_id\nfunction getLocalReviewsByIdData(id) {\n  if (!('indexedDB' in window)) {return null;}\n  return dbPromise.then(db => {\n    const tx = db.transaction('reviews', 'readonly');\n    const store = tx.objectStore('reviews');\n    const index = store.index('restaurant_id');\n    // Make sure you're using a number for id.\n    return index.getAll(parseInt(id));\n  });\n}\n"],"sourceRoot":"/source/"}